<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ¤– Ù…Ø±Ø§Ù‚Ø¨ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
      font-weight: 300;
    }

    .navigation {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .nav-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      text-decoration: none;
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      background: rgba(255, 255, 255, 0.3);
    }

    .nav-btn.active {
      background: linear-gradient(135deg, #00ff88, #00c851);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.2);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-number {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .stat-number.success { color: #00ff88; }
    .stat-number.failed { color: #ff6b6b; }
    .stat-number.pending { color: #ffa726; }
    .stat-number.total { color: #64b5f6; }

    .stat-label {
      font-size: 1.1rem;
      opacity: 0.9;
      font-weight: 500;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      gap: 15px;
      flex-wrap: wrap;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .btn.success { background: linear-gradient(135deg, #00ff88, #00c851); }
    .btn.danger { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }
    .btn.info { background: linear-gradient(135deg, #64b5f6, #42a5f5); }
    .btn.warning { background: linear-gradient(135deg, #ffa726, #ff9800); }

    .filter-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      align-items: end;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-group label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .filter-group select,
    .filter-group input {
      padding: 10px 15px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
      backdrop-filter: blur(10px);
    }

    .filter-group select option {
      background: #333;
      color: white;
    }

    .messages-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .message-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border-right: 5px solid;
      transition: all 0.3s ease;
    }

    .message-item:hover {
      transform: translateX(-5px);
      background: rgba(255, 255, 255, 0.15);
    }

    .message-item.success { border-right-color: #00ff88; }
    .message-item.failed { border-right-color: #ff6b6b; }
    .message-item.pending { border-right-color: #ffa726; }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .message-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .message-status.success {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
    }

    .message-status.failed {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
    }

    .message-status.pending {
      background: rgba(255, 167, 38, 0.2);
      color: #ffa726;
    }

    .message-time {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .message-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .detail-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 10px 15px;
      border-radius: 8px;
    }

    .detail-label {
      font-size: 0.85rem;
      opacity: 0.7;
      margin-bottom: 5px;
    }

    .detail-value {
      font-weight: 600;
      font-family: 'Courier New', monospace;
    }

    .message-error {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
    }

    .error-title {
      font-weight: 600;
      color: #ff6b6b;
      margin-bottom: 8px;
    }

    .error-details {
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      padding: 40px;
      color: #ffffff;
      font-weight: 600;
    }

    .spinner {
      width: 30px;
      height: 30px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid #ffffff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      opacity: 0.7;
    }

    .empty-state .icon {
      font-size: 4rem;
      margin-bottom: 20px;
    }

    .toast {
      position: fixed;
      top: 30px;
      left: 30px;
      z-index: 1000;
      max-width: 400px;
    }

    .toast-message {
      background: rgba(0, 0, 0, 0.9);
      color: #00ff88;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 10px;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transform: translateX(-100%);
      animation: slideInLeft 0.3s ease forwards;
    }

    .toast-message.error { color: #ff6b6b; }
    .toast-message.warning { color: #ffa726; }

    @keyframes slideInLeft {
      to { transform: translateX(0); }
    }

    .status-indicator {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px 20px;
      border-radius: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .status-indicator.online {
      border-color: #00ff88;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
    }

    .status-indicator.offline {
      border-color: #ff6b6b;
      box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .filter-grid {
        grid-template-columns: 1fr;
      }
      
      .message-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .message-details {
        grid-template-columns: 1fr;
      }

      .navigation {
        flex-direction: column;
      }

      .nav-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¤– Ù…Ø±Ø§Ù‚Ø¨ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</h1>
      <p>Ù…Ø±Ø§Ù‚Ø¨Ø© Ø´Ø§Ù…Ù„Ø© ÙˆÙ…ØªÙ‚Ø¯Ù…Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ù†Ø§Ø¬Ø­Ø© ÙˆØ§Ù„ÙØ§Ø´Ù„Ø© Ù…Ø¹ ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„</p>
    </div>

    <div class="navigation">
      <a href="/" class="nav-btn">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="/telegram-monitor" class="nav-btn active">ğŸ¤– Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</a>
      <a href="/stats" class="nav-btn">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</a>
      <button id="test-connection-btn" class="nav-btn">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number total" id="total-messages">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
      </div>
      <div class="stat-card">
        <div class="stat-number success" id="success-messages">0</div>
        <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ Ù†Ø§Ø¬Ø­Ø©</div>
      </div>
      <div class="stat-card">
        <div class="stat-number failed" id="failed-messages">0</div>
        <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ ÙØ§Ø´Ù„Ø©</div>
      </div>
      <div class="stat-card">
        <div class="stat-number pending" id="pending-messages">0</div>
        <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹Ù„Ù‚Ø©</div>
      </div>
    </div>

    <div class="controls">
      <div class="btn-group">
        <button id="refresh-btn" class="btn info">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
        <button id="auto-refresh-btn" class="btn info">â° ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
        <button id="export-btn" class="btn success">ğŸ“¥ ØªØµØ¯ÙŠØ± CSV</button>
      </div>
      <div class="btn-group">
        <button id="clear-success-btn" class="btn warning">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù†Ø§Ø¬Ø­Ø©</button>
        <button id="clear-failed-btn" class="btn danger">âŒ Ù…Ø³Ø­ Ø§Ù„ÙØ§Ø´Ù„Ø©</button>
        <button id="clear-all-btn" class="btn danger">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </div>
    </div>

    <div class="filter-section">
      <div class="filter-grid">
        <div class="filter-group">
          <label for="status-filter">Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
          <select id="status-filter">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
            <option value="success">Ù†Ø§Ø¬Ø­Ø©</option>
            <option value="failed">ÙØ§Ø´Ù„Ø©</option>
            <option value="pending">Ù…Ø¹Ù„Ù‚Ø©</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="date-from">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
          <input type="date" id="date-from">
        </div>
        <div class="filter-group">
          <label for="date-to">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
          <input type="date" id="date-to">
        </div>
        <div class="filter-group">
          <label for="barcode-filter">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
          <input type="text" id="barcode-filter" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¨Ø§Ø±ÙƒÙˆØ¯...">
        </div>
        <div class="filter-group">
          <label>&nbsp;</label>
          <button id="apply-filters-btn" class="btn info">ğŸ” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø´Ø­Ø§Øª</button>
        </div>
      </div>
    </div>

    <div class="messages-container">
      <div id="messages-list">
        <div class="loading">
          <div class="spinner"></div>
          Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...
        </div>
      </div>
    </div>
  </div>

  <div id="toast-container" class="toast"></div>

  <div id="status-indicator" class="status-indicator offline">
    <span id="status-text">âš« ØºÙŠØ± Ù…ØªØµÙ„</span>
  </div>

  <script>
    let currentFilters = {};
    let autoRefreshInterval = null;
    let isAutoRefreshEnabled = false;
    let isOnline = false;

    document.addEventListener('DOMContentLoaded', () => {
      initializePage();
      setupEventListeners();
      checkConnection();
      
      loadData();
      
      setInterval(checkConnection, 10000);
    });

    function setupEventListeners() {
      document.getElementById('refresh-btn').addEventListener('click', () => {
        loadData();
        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
      });

      document.getElementById('auto-refresh-btn').addEventListener('click', toggleAutoRefresh);

      document.getElementById('clear-success-btn').addEventListener('click', () => {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø§Ø¬Ø­Ø©ØŸ')) {
          clearMessages('success');
        }
      });

      document.getElementById('clear-failed-btn').addEventListener('click', () => {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙØ§Ø´Ù„Ø©ØŸ')) {
          clearMessages('failed');
        }
      });

      document.getElementById('clear-all-btn').addEventListener('click', () => {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
          clearMessages('all');
        }
      });

      document.getElementById('export-btn').addEventListener('click', exportToCSV);
      document.getElementById('test-connection-btn').addEventListener('click', testTelegramConnection);
      document.getElementById('apply-filters-btn').addEventListener('click', applyFilters);

      document.getElementById('barcode-filter').addEventListener('input', debounce(applyFilters, 500));
    }

    function initializePage() {
      const today = new Date();
      const weekAgo = new Date();
      weekAgo.setDate(today.getDate() - 7);
      
      document.getElementById('date-from').value = weekAgo.toISOString().split('T')[0];
      document.getElementById('date-to').value = today.toISOString().split('T')[0];

      console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…');
    }

    async function checkConnection() {
      try {
        const response = await fetch('/api/telegram/stats', {
          method: 'GET',
          headers: { 'Cache-Control': 'no-cache' }
        });
        
        const wasOnline = isOnline;
        isOnline = response.ok;
        
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        
        if (isOnline) {
          statusIndicator.className = 'status-indicator online';
          statusText.textContent = 'ğŸŸ¢ Ù…ØªØµÙ„';
          
          if (!wasOnline) {
            showToast('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'success');
          }
        } else {
          statusIndicator.className = 'status-indicator offline';
          statusText.textContent = 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„';
          
          if (wasOnline) {
            showToast('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
          }
        }
      } catch (error) {
        isOnline = false;
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        statusIndicator.className = 'status-indicator offline';
        statusText.textContent = 'ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
      }
    }

    async function loadData() {
      console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
      await Promise.all([loadStats(), loadMessages()]);
    }

    async function loadStats() {
      try {
        console.log('ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...');
        const response = await fetch('/api/telegram/stats');
        if (response.ok) {
          const stats = await response.json();
          console.log('ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', stats);
          
          document.getElementById('total-messages').textContent = stats.total || 0;
          document.getElementById('success-messages').textContent = stats.success || 0;
          document.getElementById('failed-messages').textContent = stats.failed || 0;
          document.getElementById('pending-messages').textContent = stats.pending || 0;
          
          // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
          if (!isOnline) {
            isOnline = true;
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            statusIndicator.className = 'status-indicator online';
            statusText.textContent = 'ğŸŸ¢ Ù…ØªØµÙ„';
          }
        } else {
          throw new Error(`Ø®Ø·Ø£ ${response.status}`);
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
        isOnline = false;
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        statusIndicator.className = 'status-indicator offline';
        statusText.textContent = 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„';
        
        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'error');
      }
    }

    async function loadMessages() {
      try {
        console.log('ğŸ“± ØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...');
        const params = new URLSearchParams({
          limit: 50,
          ...currentFilters
        });

        const response = await fetch(`/api/telegram/messages?${params}`);
        if (response.ok) {
          const messages = await response.json();
          console.log('ğŸ“± ØªÙ… ØªØ­Ù…ÙŠÙ„', messages.length, 'Ø±Ø³Ø§Ù„Ø©');
          displayMessages(messages);
          
          // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
          if (!isOnline) {
            isOnline = true;
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            statusIndicator.className = 'status-indicator online';
            statusText.textContent = 'ğŸŸ¢ Ù…ØªØµÙ„';
          }
        } else {
          throw new Error(`Ø®Ø·Ø£ ${response.status}`);
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:', error);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
        isOnline = false;
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        statusIndicator.className = 'status-indicator offline';
        statusText.textContent = 'ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
        
        document.getElementById('messages-list').innerHTML = `
          <div class="empty-state">
            <div class="icon">âŒ</div>
            <h3>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h3>
            <p>Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</p>
            <button onclick="loadMessages()" class="btn info" style="margin-top: 15px;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
          </div>
        `;
        showToast('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
      }
    }

    function displayMessages(messages) {
      const container = document.getElementById('messages-list');
      
      if (!messages || messages.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="icon">ğŸ“­</div>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</h3>
            <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„ ØªÙ„ÙŠØ¬Ø±Ø§Ù… ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
          </div>
        `;
        return;
      }

      container.innerHTML = messages.map(message => `
        <div class="message-item ${message.status}">
          <div class="message-header">
            <div class="message-status ${message.status}">
              ${getStatusIcon(message.status)} ${getStatusText(message.status)}
            </div>
            <div class="message-time">
              ğŸ“… ${formatDate(message.timestamp)}
            </div>
          </div>
          
          <!-- Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
          ${message.image_path ? `
            <div style="margin: 15px 0; text-align: center;">
              <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                <img src="/images/${message.image_path}" 
                     alt="ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ${message.barcode}" 
                     style="max-width: 200px; max-height: 200px; border-radius: 8px; cursor: pointer;"
                     onclick="openImageModal('/images/${message.image_path}', '${message.barcode}')"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display: none; color: #ff6b6b;">âŒ ØµÙˆØ±Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</div>
              </div>
              
              <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
              <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button onclick="resendMessage(${message.id})" 
                        class="btn success" 
                        style="padding: 8px 15px; font-size: 0.9rem;">
                  ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„
                </button>
                <button onclick="downloadImage('/images/${message.image_path}', '${message.barcode}')" 
                        class="btn info" 
                        style="padding: 8px 15px; font-size: 0.9rem;">
                  ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                </button>
                <button onclick="copyBarcode('${message.barcode}')" 
                        class="btn warning" 
                        style="padding: 8px 15px; font-size: 0.9rem;">
                  ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                </button>
              </div>
            </div>
          ` : `
            <div style="margin: 15px 0; text-align: center; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 10px;">
              <div style="color: #ffa726; margin-bottom: 10px;">ğŸ“· Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù…Ø­ÙÙˆØ¸Ø©</div>
              <button onclick="resendMessage(${message.id})" 
                      class="btn success" 
                      style="padding: 8px 15px; font-size: 0.9rem;">
                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„
              </button>
            </div>
          `}
          
          <div class="message-details">
            <div class="detail-item">
              <div class="detail-label">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</div>
              <div class="detail-value">${message.barcode || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
            </div>
            
            ${message.message_id ? `
            <div class="detail-item">
              <div class="detail-label">Ù…Ø¹Ø±Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©</div>
              <div class="detail-value">${message.message_id}</div>
            </div>
            ` : ''}
            
            ${message.image_size ? `
            <div class="detail-item">
              <div class="detail-label">Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©</div>
              <div class="detail-value">${formatBytes(message.image_size)}</div>
            </div>
            ` : ''}
            
            <div class="detail-item">
              <div class="detail-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</div>
              <div class="detail-value">${message.retry_count || 0} Ù…Ø­Ø§ÙˆÙ„Ø©</div>
            </div>
            
            ${message.response_time ? `
            <div class="detail-item">
              <div class="detail-label">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
              <div class="detail-value">${message.response_time} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©</div>
            </div>
            ` : ''}
            
            <div class="detail-item">
              <div class="detail-label">Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
              <div class="detail-value">${message.data_type || 'Ù…Ø®ØªÙ„Ø·'}</div>
            </div>
            
            ${message.image_path ? `
            <div class="detail-item">
              <div class="detail-label">Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©</div>
              <div class="detail-value" style="font-family: monospace;">${message.image_path}</div>
            </div>
            ` : ''}
          </div>

          ${message.status === 'failed' && message.error_message ? `
            <div class="message-error">
              <div class="error-title">âš ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£</div>
              <div class="error-details">${message.error_message}</div>
              ${message.error_code ? `<div class="error-details">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø£: ${message.error_code}</div>` : ''}
            </div>
          ` : ''}
          
          ${message.caption ? `
            <div class="detail-item" style="grid-column: 1 / -1; margin-top: 15px;">
              <div class="detail-label">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</div>
              <div class="detail-value" style="white-space: pre-wrap; font-family: 'Cairo', sans-serif;">${message.caption}</div>
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    function applyFilters() {
      currentFilters = {
        status: document.getElementById('status-filter').value,
        date_from: document.getElementById('date-from').value,
        date_to: document.getElementById('date-to').value,
        barcode: document.getElementById('barcode-filter').value
      };
      
      Object.keys(currentFilters).forEach(key => {
        if (!currentFilters[key]) {
          delete currentFilters[key];
        }
      });
      
      loadMessages();
      showToast('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø´Ø­Ø§Øª', 'success');
    }

    async function clearMessages(type) {
      try {
        const response = await fetch('/api/telegram/clear', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: type })
        });
        
        if (response.ok) {
          const result = await response.json();
          showToast(`ØªÙ… Ø­Ø°Ù ${result.deleted_count || 0} Ø±Ø³Ø§Ù„Ø©`, 'success');
          loadData();
        } else {
          throw new Error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„');
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', 'error');
      }
    }

    async function exportToCSV() {
      try {
        showToast('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
        
        const response = await fetch('/api/telegram/export');
        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `telegram_messages_${new Date().toISOString().split('T')[0]}.csv`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
          showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else {
          throw new Error('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
      }
    }

    async function testTelegramConnection() {
      try {
        showToast('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...', 'info');
        
        const response = await fetch('/api/telegram/test');
        if (response.ok) {
          const result = await response.json();
          if (result.success) {
            showToast(`âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ - Ø§Ù„Ø¨ÙˆØª: ${result.bot_info.username || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'success');
          } else {
            showToast('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…', 'error');
          }
        } else {
          throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„');
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
      }
    }

    function toggleAutoRefresh() {
      const btn = document.getElementById('auto-refresh-btn');
      
      if (isAutoRefreshEnabled) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        isAutoRefreshEnabled = false;
        btn.textContent = 'â° ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ';
        btn.className = 'btn info';
        showToast('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'warning');
      } else {
        autoRefreshInterval = setInterval(() => {
          if (isOnline) {
            loadData();
          }
        }, 15000);
        
        isAutoRefreshEnabled = true;
        btn.textContent = 'â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ«';
        btn.className = 'btn warning';
        showToast('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ©)', 'success');
      }
    }

    function getStatusIcon(status) {
      switch (status) {
        case 'success': return 'âœ…';
        case 'failed': return 'âŒ';
        case 'pending': return 'â³';
        default: return 'â“';
      }
    }

    function getStatusText(status) {
      switch (status) {
        case 'success': return 'Ù†Ø§Ø¬Ø­Ø©';
        case 'failed': return 'ÙØ§Ø´Ù„Ø©';
        case 'pending': return 'Ù…Ø¹Ù„Ù‚Ø©';
        default: return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      }
    }

    function formatDate(timestamp) {
      return new Date(timestamp * 1000).toLocaleString('ar-IQ', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        timeZone: 'Asia/Baghdad'
      });
    }

    function formatBytes(bytes) {
      if (bytes === 0) return '0 Ø¨Ø§ÙŠØª';
      const k = 1024;
      const sizes = ['Ø¨Ø§ÙŠØª', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast-message ${type}`;
      toast.textContent = message;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 5000);
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    async function addTestMessage() {
      try {
        const testData = {
          barcode: `TEST_${Date.now()}`,
          status: 'success',
          message_id: `test_msg_${Date.now()}`,
          chat_id: '-1002439956600',
          caption: 'Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…',
          image_size: 1024,
          response_time: 250,
          data_type: 'test'
        };

        const response = await fetch('/api/telegram/log', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(testData)
        });

        if (response.ok) {
          showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±', 'success');
          loadData();
        } else {
          throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
      }
    }

    document.addEventListener('keydown', (event) => {
      if (event.ctrlKey || event.metaKey) {
        switch (event.key) {
          case 'r':
            event.preventDefault();
            loadData();
            break;
          case 'e':
            event.preventDefault();
            exportToCSV();
            break;
          case 't':
            event.preventDefault();
            testTelegramConnection();
            break;
        }
      }
    });

    setTimeout(() => {
      showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ù…ØªØ·ÙˆØ±! ğŸ¤–', 'success');
    }, 1000);

    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');

    // ==================== Ø¯ÙˆØ§Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ù„ØµÙˆØ± ====================

    async function resendMessage(messageId) {
      try {
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        button.disabled = true;
        
        const response = await fetch(`/api/telegram/resend/${messageId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
          const result = await response.json();
          showToast(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${result.barcode}`, 'success');
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
          setTimeout(() => {
            loadData();
          }, 2000);
        } else {
          const error = await response.json();
          throw new Error(error.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
        }
        
        button.textContent = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
        }, 3000);
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + error.message, 'error');
        
        const button = event.target;
        button.textContent = 'âŒ ÙØ´Ù„';
        setTimeout(() => {
          button.textContent = 'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„';
          button.disabled = false;
        }, 3000);
      }
    }

    function openImageModal(imageSrc, barcode) {
      // Ø¥Ù†Ø´Ø§Ø¡ modal Ù„Ù„ØµÙˆØ±Ø©
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        cursor: pointer;
      `;
      
      modal.innerHTML = `
        <div style="max-width: 90vw; max-height: 90vh; position: relative;">
          <img src="${imageSrc}" 
               alt="ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ${barcode}"
               style="max-width: 100%; max-height: 100%; border-radius: 10px; box-shadow: 0 20px 40px rgba(0,0,0,0.5);">
          <div style="
            position: absolute;
            top: -50px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            font-size: 1.2rem;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 10px;
          ">
            ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${barcode}
            <br>
            <small>Ø§Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ù„Ù„Ø¥ØºÙ„Ø§Ù‚</small>
          </div>
        </div>
      `;
      
      modal.addEventListener('click', () => {
        document.body.removeChild(modal);
      });
      
      document.body.appendChild(modal);
    }

    function downloadImage(imageSrc, barcode) {
      try {
        const link = document.createElement('a');
        link.href = imageSrc;
        link.download = `barcode_${barcode}_${new Date().getTime()}.jpg`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast('ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©', 'success');
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©', 'error');
      }
    }

    function copyBarcode(barcode) {
      try {
        navigator.clipboard.writeText(barcode).then(() => {
          showToast(`ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${barcode}`, 'success');
        }).catch(() => {
          // fallback Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          const textArea = document.createElement('textarea');
          textArea.value = barcode;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showToast(`ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${barcode}`, 'success');
        });
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯', 'error');
      }
    }

    function formatBytes(bytes) {
      if (bytes === 0) return '0 Ø¨Ø§ÙŠØª';
      const k = 1024;
      const sizes = ['Ø¨Ø§ÙŠØª', 'ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª', 'Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª', 'Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

  </script>
</body>
</html> 